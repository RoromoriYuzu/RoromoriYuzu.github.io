
<!DOCTYPE html>
<html>
  <head>
    
<meta charset="utf-8" >

<title>ChromeDriver+Selenium+Python 笔记 | 路路森</title>
<meta name="description" content="生命不息，折腾不止">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://blog.diyworld.me/favicon.ico?v=1747968425405">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://blog.diyworld.me/styles/main.css">


  
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css" />
  

  


<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.1/build/highlight.min.js"></script>



  </head>
  <body>
    <div id="app" class="main">
      <div class="site-header-container">
  <div class="site-header">
    <div class="left">
      <a href="https://blog.diyworld.me">
        <img class="avatar" src="https://blog.diyworld.me/images/avatar.png?v=1747968425405" alt="" width="32px" height="32px">
      </a>
      <a href="https://blog.diyworld.me">
        <h1 class="site-title">路路森</h1>
      </a>
    </div>
    <div class="right">
      <transition name="fade">
        <i class="icon" :class="{ 'icon-close-outline': menuVisible, 'icon-menu-outline': !menuVisible }" @click="menuVisible = !menuVisible"></i>
      </transition>
    </div>
  </div>
</div>

<transition name="fade">
  <div class="menu-container" style="display: none;" v-show="menuVisible">
    <div class="menu-list">
      
        
          <a href="/" class="menu purple-link">
            首页
          </a>
        
      
        
          <a href="/archives" class="menu purple-link">
            归档
          </a>
        
      
        
          <a href="/tags" class="menu purple-link">
            标签
          </a>
        
      
        
          <a href="https://RoromoriYuzu.github.io/post/note" class="menu purple-link">
            记录
          </a>
        
      
        
          <a href="/post/about" class="menu purple-link">
            关于
          </a>
        
      
    </div>
  </div>
</transition>


      <div class="content-container">
        <div class="post-detail">
          
          <h2 class="post-title">ChromeDriver+Selenium+Python 笔记</h2>
          <div class="post-info post-detail-info">
            <span><i class="icon-calendar-outline"></i> 2022-11-30</span>
            
          </div>
          <div class="post-content" v-pre>
            <p><ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E5%AE%89%E8%A3%85">安装</a></li>
<li><a href="#%E5%B8%B8%E7%94%A8%E8%AF%AD%E5%8F%A5">常用语句</a>
<ul>
<li><a href="#%E8%8E%B7%E5%8F%96%E5%85%83%E7%B4%A0">获取元素</a></li>
<li><a href="#%E8%8E%B7%E5%8F%96%E6%9C%AC%E9%A1%B5%E9%9D%A2url">获取本页面URL</a></li>
<li><a href="#%E8%8E%B7%E5%8F%96%E6%97%A5%E5%BF%97">获取日志</a></li>
<li><a href="#%E6%96%B0%E6%A0%87%E7%AD%BE%E9%A1%B5%E6%93%8D%E4%BD%9C">新标签页操作</a></li>
<li><a href="#%E7%AA%97%E5%8F%A3%E6%93%8D%E4%BD%9C">窗口操作</a></li>
<li><a href="#%E8%AE%BE%E7%BD%AE%E5%BB%B6%E6%97%B6">设置延时</a></li>
<li><a href="#%E5%85%B3%E9%97%AD">关闭</a></li>
<li><a href="#%E6%89%93%E5%8D%B0%E7%BD%91%E9%A1%B5%E6%BA%90%E4%BB%A3%E7%A0%81">打印网页源代码</a></li>
<li><a href="#%E5%89%AA%E8%B4%B4%E6%9D%BF%E5%A4%8D%E5%88%B6%E7%B2%98%E8%B4%B4%E5%9B%BE%E7%89%87">剪贴板复制粘贴图片</a>
<ul>
<li><a href="#%E5%AE%89%E8%A3%85-win32clipboard">安装 win32clipboard</a></li>
<li><a href="#%E5%A4%8D%E5%88%B6%E6%9C%AC%E5%9C%B0%E5%9B%BE%E7%89%87">复制本地图片</a></li>
<li><a href="#%E8%AF%B7%E6%B1%82%E7%BD%91%E7%BB%9C%E5%9B%BE%E7%89%87">请求网络图片</a></li>
<li><a href="#%E6%96%B9%E6%B3%95%E4%B8%80">方法一</a></li>
<li><a href="#%E6%96%B9%E6%B3%95%E4%BA%8C">方法二</a></li>
<li><a href="#%E6%96%B9%E6%B3%95%E4%B8%89">方法三</a></li>
<li><a href="#%E6%96%B9%E6%B3%95%E5%9B%9B">方法四</a></li>
<li><a href="#%E6%96%B9%E6%B3%95%E4%BA%94">方法五</a></li>
<li><a href="#selenium-%E7%B2%98%E8%B4%B4%E5%9B%BE%E7%89%87">selenium 粘贴图片</a></li>
</ul>
</li>
<li><a href="#%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%E6%93%8D%E4%BD%9C">屏幕截图操作</a></li>
<li><a href="#%E5%89%8D%E8%BF%9B%E5%90%8E%E9%80%80%E5%88%B7%E6%96%B0">前进后退刷新</a></li>
<li><a href="#%E6%89%A7%E8%A1%8Cjs%E4%BB%A3%E7%A0%81">执行JS代码</a></li>
<li><a href="#cookies%E6%93%8D%E4%BD%9C">Cookies操作</a></li>
<li><a href="#%E6%93%8D%E4%BD%9C-localstorage">操作 localstorage</a></li>
<li><a href="#%E8%8E%B7%E5%8F%96%E6%A0%87%E9%A2%98%E5%86%85%E5%AE%B9">获取标题内容</a></li>
<li><a href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E6%B5%8F%E8%A7%88%E5%99%A8%E5%90%8D">获取当前浏览器名</a></li>
<li><a href="#%E5%85%A8%E5%B1%80%E8%B6%85%E6%97%B6%E6%97%B6%E9%97%B4">全局超时时间</a></li>
<li><a href="#%E5%85%83%E7%B4%A0%E6%93%8D%E4%BD%9C">元素操作</a></li>
<li><a href="#%E6%A8%A1%E6%8B%9F%E9%94%AE%E7%9B%98%E8%BE%93%E5%85%A5%E5%92%8C%E6%8C%89%E9%94%AE">模拟键盘输入和按键</a></li>
<li><a href="#%E9%80%89%E9%A1%B9%E6%93%8D%E4%BD%9C">选项操作</a></li>
<li><a href="#%E6%A1%86%E6%9E%B6%E6%93%8D%E4%BD%9Cframeiframe">框架操作(Frame/IFrame)</a></li>
<li><a href="#alert">Alert</a></li>
<li><a href="#%E5%88%A4%E6%96%AD">判断</a></li>
<li><a href="#%E9%80%89%E6%8B%A9">选择</a></li>
<li><a href="#%E6%98%BE%E7%A4%BA%E7%AD%89%E5%BE%85%E5%92%8C%E9%9A%90%E5%BC%8F%E7%AD%89%E5%BE%85">显示等待和隐式等待</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</p>
<h2 id="安装">安装</h2>
<ol>
<li>
<p>安装Python的Selenium库</p>
<p>打开cmd，输入</p>
<pre><code class="language-cmd">pip install selenium
</code></pre>
</li>
<li>
<p>安装Chrome浏览器后，确定Chrome的版本：【设置】-【关于Chrome】中查看<br>
<img src="https://blog.diyworld.me/post-images/1669802931387.png" alt="版本信息" loading="lazy"></p>
</li>
<li>
<p>安装ChromeDriver<br>
从镜像索引网站中下载与Chrome相同版本的Chromedriver。<a href="http://chromedriver.storage.googleapis.com/index.html">下载地址</a></p>
</li>
</ol>
<p><img src="https://blog.diyworld.me/post-images/1669802984256.jpg" alt="" loading="lazy"><br>
<img src="https://blog.diyworld.me/post-images/1669802989775.jpg" alt="" loading="lazy"></p>
<p>如果网站没有完全匹配的版本，可以选择稍大一点的版本下载。</p>
<ol start="4">
<li>将chromedriver配置到环境变量里</li>
</ol>
<figure data-type="image" tabindex="1"><img src="https://blog.diyworld.me/post-images/1669803164606.jpg" alt="" loading="lazy"></figure>
<ol start="5">
<li>
<p>测试使用</p>
<pre><code class="language-python">from selenium import webdriver
driver = webdriver.Chrome()
url = 'https://www.baidu.com/'
driver.get(url)
</code></pre>
</li>
</ol>
<ul>
<li>
<p>一些问题</p>
<p>Chrome的更新频率非常频繁，与之对应的Chromedriver版本也必须相应更新。如果两者版本的主版本号相差超过1，selenium则会报异常，大概错误信息如下：</p>
<blockquote>
<p>发生异常: SessionNotCreatedException<br>
Message: session not created: This version of ChromeDriver only supports Chrome version 95 Current browser version is 105.0.5195.102 with binary path C:\Program Files (x86)\Google\Chrome\Application\chrome.exe</p>
</blockquote>
<p>--disable-dev-shm-usage 的作用</p>
<p>--disable-dev-shm-usage 是一个启动参数，用于告诉 Chrome 不要使用 /dev/shm（即 POSIX 共享内存）来存放其数据。当使用该参数时，Chrome 会改为在 /tmp 目录下创建临时文件用于处理需要存储在内存中的数据。</p>
<p>为什么要使用这个参数<br>
容器环境的内存限制：Docker 容器环境中的 /dev/shm 大小默认为 64MB，这通常小于 Chrome 所需的空间，尤其是在打开多个标签或处理大量数据时。如果不增加这个大小，可能会导致 Chrome 行为异常或崩溃。<br>
稳定性和兼容性：使用 --disable-dev-shm-usage 参数可以提高在资源受限的环境下运行 Chrome 的稳定性，尤其是自动化测试或数据抓取任务中。</p>
</li>
</ul>
<h2 id="常用语句">常用语句</h2>
<h3 id="获取元素">获取元素</h3>
<blockquote>
<p>find_element_by_* 和 find_elements_by_* 已弃用。</p>
</blockquote>
<p><code>find_element()</code>            通过指定方法查找指定的一个元素(需指定两个参数)</p>
<pre><code class="language-python">By.CLASS_NAME           #通过Class name查找指定的一个元素
By.CSS_SELECTOR         #通过CSS选择器查找指定的一个元素
By.ID                   #通过ID查找指定的一个元素
By.LINK_TEXT            #通过链接文本获取指定的一个超链接(精确匹配)
By.NAME                 #通过Name查找指定的一个元素
By.PARTIAL_LINK_TEXT    #通过链接文本获取指定的一个超链接(模糊匹配)
By.TAG_NAME              #通过标签名查找指定的一个元素
By.XPATH                #通过Xpath语法来指定的一个元素
</code></pre>
<p>例如</p>
<pre><code class="language-python">from selenium.webdriver.common.by import By
kw1=driver.find_element(By.ID,'kw')
</code></pre>
<h3 id="获取本页面url">获取本页面URL</h3>
<pre><code class="language-python">c.current_url
</code></pre>
<h3 id="获取日志">获取日志</h3>
<pre><code class="language-python">c.log_types  #获取当前日志类型
c.get_log('browser')#浏览器操作日志
c.get_log('driver') #设备日志
c.get_log('client') #客户端日志
c.get_log('server') #服务端日志
</code></pre>
<h3 id="新标签页操作">新标签页操作</h3>
<p>如果是新打开的页签，这个时候一定要先移动句柄，再抓取网页内容</p>
<pre><code class="language-python">newwindow = 'window.open(&quot;https://www.baidu.com&quot;)'
c.execute_script(newwindow) #浏览器 新窗口打开连接
c.switch_to.window(c.window_handles[1]) #移动句柄，对新打开页面进行操作
c.close() #关闭该新打开的页面
c.switch_to.window(c.window_handles[0]) #不关闭，要移动到上一个页面，我们要移动句柄
</code></pre>
<h3 id="窗口操作">窗口操作</h3>
<pre><code class="language-python">c.maximize_window()#最大化
c.fullscreen_window() #全屏
c.minimize_window() #最小化
c.get_window_position() #获取窗口的坐标
c.get_window_rect()#获取窗口的大小和坐标
c.get_window_size()#获取窗口的大小
c.set_window_position(100,200)#设置窗口的坐标
c.set_window_rect(100,200,32,50)    #设置窗口的大小和坐标
c.set_window_size(400,600)#设置窗口的大小
c.current_window_handle   #返回当前窗口的句柄
c.window_handles         #返回当前会话中的所有窗口的句柄
</code></pre>
<h3 id="设置延时">设置延时</h3>
<pre><code class="language-python">c.set_script_timeout(5) #设置脚本延时五秒后执行
c.set_page_load_timeout(5)#设置页面读取时间延时五秒
</code></pre>
<h3 id="关闭">关闭</h3>
<pre><code class="language-python">c.close() #关闭当前标签页
c.quit() #关闭浏览器并关闭驱动
</code></pre>
<h3 id="打印网页源代码">打印网页源代码</h3>
<pre><code class="language-python">c.page_source
</code></pre>
<h3 id="剪贴板复制粘贴图片">剪贴板复制粘贴图片</h3>
<h4 id="安装-win32clipboard">安装 win32clipboard</h4>
<p>win32clipboard 集成于 win32api 中，不需要单独安装，直接安装 pywin32 就可以了</p>
<pre><code class="language-python">pip install pywin32
</code></pre>
<h4 id="复制本地图片">复制本地图片</h4>
<pre><code class="language-python">import win32clipboard
from PIL import Image
from io import BytesIO

def copy_image_to_clipboard(img_path: str):
    '''输入文件名，执行后，将图片复制到剪切板'''
    image = Image.open(img_path)
    output = BytesIO()
    image.save(output, 'BMP')
    data = output.getvalue()[14:]
    output.close()
    win32clipboard.OpenClipboard()
    win32clipboard.EmptyClipboard()
    win32clipboard.SetClipboardData(win32clipboard.CF_DIB, data)
    win32clipboard.CloseClipboard()
</code></pre>
<h4 id="请求网络图片">请求网络图片</h4>
<h4 id="方法一">方法一</h4>
<pre><code class="language-python">from urllib import request
from PIL import Image
img = Image.open(request.urlopen(url))
</code></pre>
<h4 id="方法二">方法二</h4>
<pre><code class="language-python">import requests
from PIL import Image

response = requests.get(url, stream=True)
img = Image.open(response.raw)
img

# 如果想要将PIL图片格式转化为OpenCV图片格式，可以使用如下方法
import numpy as np
img = cv.cvtColor(np.array(img), cv.COLOR_RGB2BGR)

</code></pre>
<h4 id="方法三">方法三</h4>
<pre><code class="language-python">from io import BytesIO

import requests
from PIL import Image

response = requests.get(url)
img = Image.open(BytesIO(response.content))
img

</code></pre>
<h4 id="方法四">方法四</h4>
<pre><code class="language-python">from io import BytesIO

import matplotlib.pyplot as plt
import requests

response = requests.get(url)
img = plt.imread(BytesIO(response.content), format=&quot;JPG&quot;)
plt.imshow(img)

</code></pre>
<h4 id="方法五">方法五</h4>
<pre><code class="language-python">import matplotlib.pyplot as plt
from imageio import imread

# 此方法读取的图像和OpenCV一样，都是numpy.ndarray对象，只不过通道相反
# img[:,:,::-1] 转化为OpenCV图像格式
img = imread(url)
plt.imshow(img)
plt.show()

</code></pre>
<h4 id="selenium-粘贴图片">selenium 粘贴图片</h4>
<pre><code class="language-python">copy_image_to_clipboard('xxx.jpg')
c.find_element_by_css_selector('.im-editor &gt; div').send_keys(Keys.CONTROL, 'v')
</code></pre>
<h3 id="屏幕截图操作">屏幕截图操作</h3>
<pre><code class="language-python">c.save_screenshot('1.png')#截图，只支持PNG格式
c.get_screenshot_as_png() #获取当前窗口的截图作为二进制数据
c.get_screenshot_as_base64() #获取当前窗口的截图作为base64编码的字符串
</code></pre>
<h3 id="前进后退刷新">前进后退刷新</h3>
<pre><code class="language-python">c.forward() #前进
c.back()  #后退
c.refresh()#刷新
</code></pre>
<h3 id="执行js代码">执行JS代码</h3>
<p>在Selenium中也可以自定义JS代码并带到当前页面中去执行，如下：</p>
<pre><code class="language-python">from selenium import webdriver
from selenium.webdriver.common.by import By
import time
c=webdriver.Chrome()
c.get('https://www.baidu.com')
kw1=c.find_element(By.ID,'kw')
c.execute_script(&quot;alert('hello')&quot;)
time.sleep(3)
c.quit()
</code></pre>
<h3 id="cookies操作"><a href="https://www.cnblogs.com/sundahua/p/10202494.html">Cookies操作</a></h3>
<pre><code class="language-python">c.get_cookie('BAIDUID') #获取指定键的Cookies
c.get_cookies()         #获取所有的Cookies
c.add_cookie(x) #添加Cookies  
c.delete_cookie('BAIDUID') #删除指定键的Cookies内容
c.delete_all_cookies() #删除所有cookies
</code></pre>
<h3 id="操作-localstorage">操作 localstorage</h3>
<pre><code class="language-python">
读取value

from selenium import webdriver
browser = webdriver.Chrome()
browser.get('http://www.baidu.com/')
value = browser.execute_script('return localStorage.getItem(&quot;wwwPassLogout&quot;);')

assert value == &quot;0&quot;


更新value

from selenium import webdriver
browser = webdriver.Chrome()
browser.get('http://www.baidu.com/')
driver.execute_script('localStorage.setItem(&quot;wwwPassLogout&quot;, &quot;2&quot;);')

assert browser.execute_script('return localStorage.getItem(&quot;wwwPassLogout&quot;);') == &quot;2&quot;
</code></pre>
<h3 id="获取标题内容">获取标题内容</h3>
<pre><code class="language-python">c.title
</code></pre>
<h3 id="获取当前浏览器名">获取当前浏览器名</h3>
<pre><code class="language-python">c.name
</code></pre>
<h3 id="全局超时时间">全局超时时间</h3>
<pre><code class="language-python">c.implicitly_wait(5)
</code></pre>
<h3 id="元素操作">元素操作</h3>
<pre><code class="language-python">kw1.clear()        #清除元素的值
kw1.click()        #点击元素
kw1.id             #Selenium所使用的内部ID
kw1.get_property('background') #获取元素的属性的值
kw1.get_attribute('id') #获取元素的属性的值
kw1.location       #不滚动获取元素的坐标
kw1.location_once_scrolled_into_view  #不滚动且底部对齐并获取元素的坐标
kw1.parent         #父元素
kw1.send_keys('')  #向元素内输入值
kw1.size           #大小
kw1.submit         #提交
kw1.screenshot('2.png') #截取元素形状并保存为图片
kw1.tag_name       #标签名
kw1.text           #内容，如果是表单元素则无法获取
kw1.is_selected()  #判断元素是否被选中
kw1.is_enabled()   #判断元素是否可编辑
kw1.is_displayed   #判断元素是否显示
kw1.value_of_css_property('color') #获取CSS元素属性的值
kw1._upload('2.png') #上传文件
</code></pre>
<h3 id="模拟键盘输入和按键">模拟键盘输入和按键</h3>
<pre><code class="language-python">click(on_element=None)                 #鼠标左键单击
click_and_hold(on_element=None)        #单击鼠标左键，不松开
context_click(on_element=None)         #单击鼠标右键
double_click(on_element=None)          #双击鼠标左键
drag_and_drop(source,target)           #拖拽到某个元素然后松开
drag_and_drop_by_offset(source,xoffset,yoffset) #拖拽到某个坐标然后松开
key_down(value,element=None)     #按下键盘上的某个键
key_up(value, element=None)      #松开键盘上的某个键
move_by_offset(xoffset, yoffset)  #鼠标从当前位置移动到某个坐标
move_to_element(to_element)        #鼠标移动到某个元素
move_to_element_with_offset(to_element, xoffset, yoffset) #移动到距某个元素（左上角坐标）多少距离的位置
pause(seconds)                  #暂停所有输入(指定持续时间以秒为单位)
perform()                       #执行所有操作
reset_actions()                 #结束已经存在的操作并重置
release(on_element=None)       #在某个元素位置松开鼠标左键
send_keys(*keys_to_send)        #发送某个键或者输入文本到当前焦点的元素
send_keys_to_element(element, *keys_to_send) #发送某个键到指定元素
</code></pre>
<p>例如</p>
<pre><code class="language-python">from selenium import webdriver
from selenium.webdriver.common.by import By
import time
from selenium.webdriver.common.keys import Keys
from selenium.webdriver.common.action_chains import ActionChains
c=webdriver.Chrome()
c.get('https://www.baidu.com')
a=ActionChains(c)
kw1=c.find_element(By.ID,'kw')
tj=c.find_element(By.ID,'su')
tj.send_keys(Keys.CONTROL,'c') #复制
a.drag_and_drop(kw1,tj).perform()#从输入框拖动到搜索按钮
kw1.send_keys(Keys.CONTROL,'v')#粘贴
tj.send_keys(Keys.ENTER)
time.sleep(3)
c.close()
c.quit()
</code></pre>
<h3 id="选项操作">选项操作</h3>
<pre><code class="language-python">from selenium.webdriver.chrome.options import Options
o = Options()

browser = webdriver.Chrome(options=o)
</code></pre>
<pre><code class="language-python">o.set_headless()          #设置启动无界面化
o.binary_location(value)  #设置chrome二进制文件位置
o.add_argument(arg)               #添加启动参数
o.add_extension(path)                #添加指定路径下的扩展应用
o.add_encoded_extension(base64)      #添加经过Base64编码的扩展应用
o.add_experimental_option(name,value)         #添加实验性质的选项
o.debugger_address(value)                #设置调试器地址 
o.to_capabilities()                    #获取当前浏览器的所有信息
------------------------------------------------------------------------------
o.add_experimental_option('excludeSwitches', ['enable-automation'])#开发者模式
o.add_argument('--disable-blink-features=AutomationControlled') #防止检测
o.add_argument('--window-size=600,600') #设置窗口大小
o.add_experimental_option(&quot;detach&quot;, True) #不自动关闭窗口
o.add_argument('--incognito') #无痕模式
 o.add_argument('--disable-infobars') #去掉chrome正受到自动测试软件的控制的提示（高版本 Chromium 不再支持禁用信息栏）
o.add_argument('user-agent=&quot;XXXX&quot;') #添加请求头
o.add_argument(&quot;--proxy-server=http://200.130.123.43:3456&quot;)#代理服务器访问
o.add_experimental_option(&quot;prefs&quot;,{&quot;profile.managed_default_content_settings.images&quot;: 2}) #禁止加载图片
o.add_experimental_option('prefs',
{'profile.default_content_setting_values':{'notifications':2}}) #禁用浏览器弹窗
o.add_argument('blink-settings=imagesEnabled=false')  #禁止加载图片
o.add_argument('lang=zh_CN.UTF-8') #设置默认编码为utf-8
o.add_extension(create_proxyauth_extension(
           proxy_host='host',
           proxy_port='port',
           proxy_username=&quot;username&quot;,
           proxy_password=&quot;password&quot;
       ))# 设置有账号密码的代理
o.add_argument('--disable-gpu')  # 这个属性可以规避谷歌的部分bug
o.add_argument('--disable-javascript')  # 禁用javascript
o.add_argument('--hide-scrollbars')  # 隐藏滚动条
o.binary_location=r&quot;C:\Users\Administrator\AppData\Local\Google\Chrome\Application&quot; #指定浏览器位置
o.add_argument('--no-sandbox')  #解决DevToolsActivePort文件不存在的报错

</code></pre>
<h3 id="框架操作frameiframe">框架操作(Frame/IFrame)</h3>
<pre><code class="language-python">from selenium import webdriver
from selenium.webdriver.common.by import By
import time
c=webdriver.Chrome()
c.implicitly_wait(10)
c.get('https://hao.360.com/?a1004')
#ss=c.find_element(By.CLASS_NAME,'NEWS_FEED_VIDEO_1595850774217HPA70')#不容易找到标签
c.switch_to.frame(0)#索引
c.switch_to.frame('NEWS_FEED_VIDEO_1595850774217HPA70-VideoIframe') #ID
c.switch_to.frame('NEWS_FEED_VIDEO_1595850774217HPA70')#Class
c.switch_to.frame(c.find_element_by_tag_name(&quot;iframe&quot;))#标签
time.sleep(3)
c.close()
c.quit()
</code></pre>
<p>如果我们遍历到最后了如何返回主框架了，可以这样做，如下所示：</p>
<pre><code class="language-python">c.switch_to.default_content()
</code></pre>
<p>这样就可以回到主框架继续进行操作了。如果我们由里往外遍历的话，那么可以这样来做，如下：</p>
<pre><code class="language-python">c.switch_to.parent_frame()
</code></pre>
<h3 id="alert">Alert</h3>
<p>在弹窗处理中，我们会遇到三种情况，如下：</p>
<p>浏览器弹出框<br>
新窗口弹出框<br>
人为弹出框</p>
<ol>
<li>浏览器弹出框</li>
</ol>
<p>首先说说浏览器弹出框，想必大家对JavaScript中的Alert，Confirm，Prompt应该不是很陌生，就是弹出框，确认框，输入框；基本方法我们来看下，如下：</p>
<pre><code class="language-python">from selenium.webdriver.common.alert import Alert
c=webdriver.Chrome()
c.implicitly_wait(10)
c.get('https://www.baidu.com')
a1=Alert(c)
a1.accept() #确定
a1.dismiss() #取消
a1.authenticate(username,password) #用户身份验证
a1.send_keys('') #输入文本或按键
a1.text  #获取弹窗内容
</code></pre>
<p>这里我们应对每种情况它上面的方法的对应位置都是会有所变化的，所以我们需要根据具体情况来进行操作，而且还可以使用另一种方法，如下：</p>
<pre><code class="language-python">c=webdriver.Chrome()
c.implicitly_wait(10)
c.get('https://www.baidu.com')
a1=c.switch_to_alert()
a1.accept() #确定
a1.dismiss() #取消
a1.authenticate(username,password) #用户身份验证
a1.send_keys('') #输入文本或按键
a1.text  #获取弹窗内容
</code></pre>
<p>注：该类方法必须在有弹框的情况下才有作用，如没有会报错。</p>
<ol start="2">
<li>新窗口弹出框</li>
</ol>
<p>上面就是浏览器弹出框的处理方法了，如果是新窗口弹出的话那么就不一样了，我们需要通过句柄来定位，前面我们提到过这两个方法。下面我们来看看它们的具体用法，如下：</p>
<pre><code class="language-python">from selenium import webdriver
from selenium.webdriver.common.by import By
import time
c=webdriver.Chrome()
c.implicitly_wait(10)
c.get('https://www.baidu.com')
kw1=c.find_element(By.ID,'kw')
tj=c.find_element(By.ID,'su')
hwnd=c.window_handles #所有窗口句柄
for h in hwnd:
   if h !=c.current_window_handle:  #如果句柄不是当前窗口句柄则切换                          c.switch_to_window(h)  #切换窗口
   else:
       print('无需切换窗口') 
time.sleep(3)
c.close()
c.quit()
</code></pre>
<p>注：如果有多个窗口，当你关闭了当前窗口想切换到另一个窗口，你需要把没关闭的窗口切换成当前活动窗口，因为Selenium是不会为你做这件事的。</p>
<ol start="3">
<li>人为弹出框</li>
</ol>
<p>这类弹出框是我们自己开发的，一般都是使用Div包裹一些其它的元素标签然后形成一个整体，当我们触发某个事件的时候就会出现，否则消失。这种弹出框使用我们的众多Find前缀的方法就能遍历到，很方便，这里不一一细说。</p>
<h3 id="判断">判断</h3>
<p>在Selenium中我们在做自动化测试时常无法判断一个元素是否真的显示出来了，因此会各种报错，接下来我们对这些操作进行判断，如果显示出了我们预期的值，那么就进行下一步操作，否则就关闭或者暂停几秒然后再判断，这里我要Selenium中的一个模块-----Expected_Conditions，简称为EC，如下所示：</p>
<pre><code class="language-python">from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.support import expected_conditions as EC
import time
c=webdriver.Chrome()
c.implicitly_wait(10)
c.get('https://baidu.com')
t=EC.title_is('百度一下，你就知道')
print(t(c))
time.sleep(3)
c.close()
c.quit()
</code></pre>
<p>这里其实就是判断当前页面的标题是否是我们给定的文本，可以看出这里为True，说明是。</p>
<p>其它方法，如下所示：</p>
<pre><code class="language-python">EC.title_contains('')(c)#判断页面标题是否包含给定的字符串
EC.presence_of_element_located('')(c) #判断某个元素是否加载到dom树里，该元素不一定可见
EC.url_contains('')(c) #判断当前url是否包含给定的字符串
EC.url_matches('')(c) #匹配URL
EC.url_to_be('')(c)  #精确匹配
EC.url_changes('')(c) #不完全匹配
EC.visibility_of_element_located('')(c) #判断某个元素是否可见,可见代表元素非隐藏元素
EC.visibility_of('')(c)   #跟上面一样，不过是直接传定位到的element
EC.presence_of_all_elements_located('')(c) #判断是否至少有1个元素存在于dom树中
EC.visibility_of_any_elements_located('')(c) #判断是否至少一个元素可见，返回列表
EC.visibility_of_all_elements_located('')(c) #判断是否所有元素可见，返回列表
EC.text_to_be_present_in_element('')(c) #判断元素中的text是否包含了预期的字符串
EC.text_to_be_present_in_element_value('')(c)#判断元素中value属性是否包含预期的字符串
EC.frame_to_be_available_and_switch_to_it('')(c) # 判断该frame是否可以switch进去
EC.invisibility_of_element_located('')(c) #判断某个元素是否不存在于dom树或不可见
EC.element_to_be_clickable('')(c) #判断某个元素中是否可见并且可点击
EC.staleness_of('')(c)  #等某个元素从dom树中移除
EC.element_to_be_selected('')(c)  #判断某个元素是否被选中了,一般用在下拉列表
EC.element_located_to_be_selected('')(c) #判断元组中的元素是否被选中
EC.element_selection_state_to_be('')(c) #判断某个元素的选中状态是否符合预期
EC.element_located_selection_state_to_be('')(c) #跟上面一样，只不过是传入located
EC.number_of_windows_to_be('')(c)  #判断窗口中的数字是否符合预期
EC.new_window_is_opened('')(c)  #判断新的窗口是否打开
EC.alert_is_present('')(c)  #判断页面上是否存在alert
</code></pre>
<h3 id="选择">选择</h3>
<pre><code class="language-python">from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.support import expected_conditions as EC
from selenium.webdriver.support.select import Select
import time
c=webdriver.Chrome()
c.implicitly_wait(10)
c.get('http://www.juliwz.cn/forum.php')
s=Select(c.find_element_by_id('ls_fastloginfield'))#实例化
res=s.all_selected_options#全部选中子项
res1=s.options#全部子项
print(res)
print(res1)
time.sleep(3)
c.close()
c.quit()
</code></pre>
<p>Select里面的方法也是相当多的，如下：</p>
<pre><code class="language-python">s.first_selected_option  #第一个选中的子项
s.select_by_index(index) #根据索引选择
s.select_by_value(value)   #根据值来选择
s.select_by_visible_text(text)  #根据选项可见文本
s.deselect_by_index(index)   #根据索引来取消选择
s.deselect_by_value(value)   #根据值来取消选择
s.deselect_by_visible_text(text)  #根据可见文本来取消选择
s.deselect_all()                #取消所有选择
</code></pre>
<h3 id="显示等待和隐式等待">显示等待和隐式等待</h3>
<p>显示等待就是浏览器在我们设置的时间内不断寻找，等到元素后才继续执行，如果没在规定时间内找到，也会抛异常；而隐式等待则是我们设置时间，然后程序去找元素，期间会不断刷新页面，到了时间仍然没找到就抛异常。这里有个常用的模块专门用来实现显示等待和隐式等待的，它就是”wait“。如下：</p>
<pre><code class="language-python">from selenium.webdriver.support.ui import WebDriverWait
from selenium import webdriver
from selenium.webdriver.common.by import By
import time
c=webdriver.Chrome()
c.get('https://www.baidu.com/')
su=WebDriverWait(c,10).until(lambda x:x.find_element_by_id('su')) 
su.location_once_scrolled_into_view
print(su.get_attribute('value'))
time.sleep(3)
c.close()
c.quit()
</code></pre>
<p>隐式等待很简单，就一行代码，如下：</p>
<pre><code class="language-python">c.implicitly_wait(10)
</code></pre>
<p>它的等待时间适用于全局的环境，也就是任何地方找不到某个元素，它都将发挥作用，如果找得到，则不会产生作用。</p>
<hr>
<p>摘抄自：<a href="https://zhuanlan.zhihu.com/p/343948620">Selenium超级详细的教程</a></p>

          </div>
        </div>

        
          <div class="next-post">
            <a class="purple-link" href="https://blog.diyworld.me/post/GrXLFXHRK/">
              <h3 class="post-title">
                下一篇：常用加密和编码结果的特征小总结
              </h3>
            </a>
          </div>
          
      </div>

      
        
          <div id="gitalk-container"></div>
        

        
      

      <div class="site-footer">
  <div class="slogan">生命不息，折腾不止</div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <a class="rss" href="https://blog.diyworld.me/atom.xml" target="_blank">RSS</a>
</div>


    </div>
    <script type="application/javascript">

hljs.initHighlightingOnLoad()

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>



  
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>

      var gitalk = new Gitalk({
        clientID: 'df0154d6a9f45f1e95f3',
        clientSecret: '72bdef4a1fb6001d84fb3f09c9e7c840c4887d68',
        repo: 'RoromoriYuzu.github.io',
        owner: 'RoromoriYuzu',
        admin: ['RoromoriYuzu'],
        id: (location.pathname).substring(0, 49),      // Ensure uniqueness and length less than 50
        distractionFreeMode: false  // Facebook-like distraction free mode
      })

      gitalk.render('gitalk-container')

    </script>
  

  




  </body>
</html>
