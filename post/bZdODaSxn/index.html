
<!DOCTYPE html>
<html>
  <head>
    
<meta charset="utf-8" >

<title>é€†å‘ WebPack æ‰“åŒ…ç½‘ç«™ä½¿ç”¨ wasm åŠ å¯† Sign å‚æ•°çš„é€»è¾‘ | è·¯è·¯æ£®</title>
<meta name="description" content="ç”Ÿå‘½ä¸æ¯ï¼ŒæŠ˜è…¾ä¸æ­¢">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://blog.diyworld.me/favicon.ico?v=1747968425405">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://blog.diyworld.me/styles/main.css">


  
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css" />
  

  


<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.1/build/highlight.min.js"></script>



  </head>
  <body>
    <div id="app" class="main">
      <div class="site-header-container">
  <div class="site-header">
    <div class="left">
      <a href="https://blog.diyworld.me">
        <img class="avatar" src="https://blog.diyworld.me/images/avatar.png?v=1747968425405" alt="" width="32px" height="32px">
      </a>
      <a href="https://blog.diyworld.me">
        <h1 class="site-title">è·¯è·¯æ£®</h1>
      </a>
    </div>
    <div class="right">
      <transition name="fade">
        <i class="icon" :class="{ 'icon-close-outline': menuVisible, 'icon-menu-outline': !menuVisible }" @click="menuVisible = !menuVisible"></i>
      </transition>
    </div>
  </div>
</div>

<transition name="fade">
  <div class="menu-container" style="display: none;" v-show="menuVisible">
    <div class="menu-list">
      
        
          <a href="/" class="menu purple-link">
            é¦–é¡µ
          </a>
        
      
        
          <a href="/archives" class="menu purple-link">
            å½’æ¡£
          </a>
        
      
        
          <a href="/tags" class="menu purple-link">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="https://RoromoriYuzu.github.io/post/note" class="menu purple-link">
            è®°å½•
          </a>
        
      
        
          <a href="/post/about" class="menu purple-link">
            å…³äº
          </a>
        
      
    </div>
  </div>
</transition>


      <div class="content-container">
        <div class="post-detail">
          
          <h2 class="post-title">é€†å‘ WebPack æ‰“åŒ…ç½‘ç«™ä½¿ç”¨ wasm åŠ å¯† Sign å‚æ•°çš„é€»è¾‘</h2>
          <div class="post-info post-detail-info">
            <span><i class="icon-calendar-outline"></i> 2023-08-10</span>
            
              <span>
                <i class="icon-pricetags-outline"></i>
                
                  <a href="https://blog.diyworld.me/tag/OE_gcQIAN/">
                    é€†å‘
                    
                      ï¼Œ
                    
                  </a>
                
                  <a href="https://blog.diyworld.me/tag/A9NeaOFri5/">
                    å­¦ä¹ 
                    
                      ï¼Œ
                    
                  </a>
                
                  <a href="https://blog.diyworld.me/tag/uTKWNErwT/">
                    Javascript
                    
                  </a>
                
              </span>
            
          </div>
          <div class="post-content" v-pre>
            <p><ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#js-%E5%B1%82%E5%8A%A8%E6%80%81%E5%88%86%E6%9E%90">JS å±‚åŠ¨æ€åˆ†æ</a>
<ul>
<li><a href="#x-nonce"><code>x-nonce</code></a></li>
<li><a href="#x-sign"><code>x-sign</code></a></li>
</ul>
</li>
<li><a href="#webassembly-%E5%88%86%E6%9E%90">WebAssembly åˆ†æ</a>
<ul>
<li><a href="#%E5%AF%BC%E5%85%A5%E5%87%BD%E6%95%B0">å¯¼å…¥å‡½æ•°</a></li>
<li><a href="#%E5%AF%BC%E5%87%BA%E5%87%BD%E6%95%B0">å¯¼å‡ºå‡½æ•°</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</p>
<blockquote>
<p>å‘ç°ä¸€ä¸ªå°ç¨‹åºæœ‰ä¸ªç­¾åˆ°ï¼ŒæŠ“åŒ…å¯¹åº”ç½‘å€å‘ç°å…¶ä¸­æœ‰ä¸ªSignåŠ å¯†å‚æ•°ï¼Œæœ¬æƒ³ç€éšä¾¿è¯•ä¸€ä¸‹ï¼Œæ²¡æƒ³åˆ°ç‰µæ‰¯åˆ°é‚£ä¹ˆå¤šä¸œè¥¿ï¼Œå°±èŠ±äº†æ•´æ•´ä¸€ä¸ªæ˜ŸæœŸçš„æ—¶é—´æ¥ç ”ç©¶ã€‚è¿‡ç¨‹å¯èƒ½ä¸å¤ªè¯¦ç»†ï¼Œæ¯•ç«Ÿæˆ‘ä¹Ÿæ˜¯ç°å­¦ç°å–ğŸ˜‚ç”šè‡³jsè¯­æ³•éƒ½æ²¡å­¦é€šï¼Œéƒ½æ˜¯å¤´ä¸€æ¬¡è§åˆ°çš„æŠ€æœ¯ ã€‚</p>
</blockquote>
<h2 id="js-å±‚åŠ¨æ€åˆ†æ">JS å±‚åŠ¨æ€åˆ†æ</h2>
<p>ç½‘ç«™åœ°å€ï¼š aHR0cHM6Ly91bS5pb3V0dS5jbi90eS9hc3NhbS9sdWNreS1kZXRhaWw=</p>
<p>é¦–å…ˆç½‘ç«™ï¼Œç„¶åè¿›è¡ŒæŠ“åŒ…</p>
<figure data-type="image" tabindex="1"><img src="https://blog.diyworld.me/post-images/1691684298555.png" alt="" loading="lazy"></figure>
<p>é€šè¿‡åˆ·æ–°å¤šæ¬¡è¯·æ±‚ï¼Œå‘ç° <code>x-ts</code> <code>x-sign</code> <code>x-nonce</code> è¿™ä¸‰ä¸ªå€¼æ˜¯ä¸€ç›´åœ¨å˜åŒ–çš„ï¼Œ<code>x-ts</code> æ˜æ˜¾æ˜¯æ—¶é—´æˆ³ï¼Œæ¥ä¸‹æ¥éœ€è¦åˆ†æ <code>x-sign</code> <code>x-nonce</code> è¿™ä¸¤ä¸ªå€¼çš„æ¥æºã€‚</p>
<p><img src="https://blog.diyworld.me/post-images/1691685825981.jpg" alt="" loading="lazy"><br>
ä¸€èˆ¬ç›´æ¥ Ctrl+Shift+F æœç´¢å­—ç¬¦ä¸²å¯ä»¥æ‰¾åˆ°ç›¸å…³å‡½æ•°ï¼Œä½†è¯¥ç½‘ç«™çš„ js æ–‡ä»¶æ˜¯ç”± <a href="https://zh.wikipedia.org/zh-cn/Webpack">WebPack</a> æ‰“åŒ…è¿‡çš„ï¼Œä»£ç ç»“æ„éƒ½å’Œä¸Šå›¾å·®ä¸å¤šï¼Œå­—ç¬¦ä¸²å…¨åœ¨åŒä¸€ä¸ªåœ°æ–¹ï¼Œä¸å¥½å¯»æ‰¾å‡½æ•°ã€‚è€Œä¸”æ‰“XHRæ–­ç‚¹ä¹Ÿæ— æ•ˆï¼Œæ‰€ä»¥æ‰¾å‡½æ•°ä½ç½®å°±èŠ±äº†ä¸å°‘æ—¶é—´ã€‚</p>
<p>æ‰“å¼€ F12 æŸ¥çœ‹è¯·æ±‚çš„è°ƒç”¨å †æ ˆ<br>
<img src="https://blog.diyworld.me/post-images/1691685352561.jpg" alt="" loading="lazy"></p>
<p>è¿›å…¥ç¬¬ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œä¸‹æ–­ç‚¹<br>
<img src="https://blog.diyworld.me/post-images/1691685464495.jpg" alt="" loading="lazy"></p>
<p>ç„¶åä¸€ç›´ F11 æ­¥å…¥ï¼Œç›´åˆ°å‘å‡ºè¯·æ±‚ä¹Ÿæ²¡å‘ç°é‚£ä¸¤ä¸ªå‚æ•°çš„ç”Ÿæˆï¼Œçœ‹æ¥é‡ç‚¹ä¸åœ¨è¿™ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆå†å¾€ä¸Šä¸ªå‡½æ•°è¯•è¯•ï¼Œä¸‹æ–­ç‚¹ï¼Œæ…¢æ…¢F10æˆ–F9ã€‚</p>
<figure data-type="image" tabindex="2"><img src="https://blog.diyworld.me/post-images/1691685965446.jpg" alt="" loading="lazy"></figure>
<p>æ­¥å…¥è¿‡ç¨‹å‘ç°ç›®æ ‡urlï¼Œåº”è¯¥ç¦»å‚æ•°çš„ç”Ÿæˆä¸è¿œï¼Œç»§ç»­ï¼Œè°ƒè¯• WebPack ç”Ÿæˆçš„ä»£ç å¤ªè´¹æ—¶é—´äº†ï¼Œè€Œä¸”è¿˜æ²¡ Mapæ–‡ä»¶ï¼Œå°±æ‰¾å‡½æ•°çš„è¿‡ç¨‹èŠ±äº†æˆ‘ä¸¤ä¸‰å¤©ï¼Œæœ€ç»ˆæ‰¾åˆ°äº†ç”Ÿæˆè¿™ä¸¤ä¸ªå€¼çš„å‡½æ•°ã€‚</p>
<h3 id="x-nonce"><code>x-nonce</code></h3>
<pre><code class="language-js">    3682: (t,e,r)=&gt;{
        t = r.nmd(t);
        var n = o;
        function o(t, e) {
            var r = i();
            return (o = function(t, e) {
                return r[t -= 447]
            }
            )(t, e)
        }
        function i() {
            var t = [&quot;169360Tjwntv&quot;, &quot;502651XRPFzm&quot;, &quot;toString&quot;, &quot;xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx&quot;, &quot;25326684vkpEiT&quot;, &quot;20PuHlQf&quot;, &quot;243FimiQP&quot;, &quot;11SFCgQb&quot;, &quot;48OdOxac&quot;, &quot;69604GYVZvv&quot;, &quot;1598324QxtHuy&quot;, &quot;70pKqhLY&quot;, &quot;3552831YclxpX&quot;, &quot;636306pSQgnQ&quot;, &quot;replace&quot;, &quot;random&quot;, &quot;exports&quot;];
            return (i = function() {
                return t
            }
            )()
        }
        (function(t, e) {
            for (var r = o, n = t(); ; )
                try {
                    if (790495 === parseInt(r(457)) / 1 + parseInt(r(456)) / 2 + -parseInt(r(462)) / 3 * (-parseInt(r(448)) / 4) + parseInt(r(450)) / 5 * (parseInt(r(452)) / 6) + parseInt(r(449)) / 7 * (-parseInt(r(447)) / 8) + parseInt(r(451)) / 9 * (parseInt(r(461)) / 10) + parseInt(r(463)) / 11 * (-parseInt(r(460)) / 12))
                        break;
                    n.push(n.shift())
                } catch (t) {
                    n.push(n.shift())
                }
        }
        )(i),
        t[n(455)] = function() {
            var t = n;
            return t(459)[t(453)](/[xy]/g, (function(e) {
                var r = t
                  , n = 16 * Math[r(454)]() | 0;
                return (&quot;x&quot; == e ? n : 3 &amp; n | 8)[r(458)](16)
            }
            ))
        }
    }
</code></pre>
<p>å…¶ä¸­ç±»ä¼¼ r(xxx)ï¼Œt(xxx) çš„å‡½æ•°å…¶å®éƒ½æ˜¯oå‡½æ•°ï¼Œæ˜¯å°† t æ•°ç»„çš„å€¼å–å‡ºï¼Œè¿™æ®µä»£ç é¦–å…ˆç»è¿‡ä¸­é—´çš„é‚£æ®µä»£ç è°ƒæ•´ t æ•°ç»„ä¸­å„ä¸ªå€¼çš„ä½ç½®ï¼Œç„¶åé€šè¿‡è°ƒç”¨oå‡½æ•°ï¼Œè¾“å‡ºæŒ‡å®šä½ç½®çš„å€¼ã€‚t æ•°ç»„ä¹Ÿç©¿æ’äº†ä¸€å †æ— ç”¨å€¼ï¼Œè‡ªå·±å¤åŸt(xxx)éå¸¸ä¸æ–¹ä¾¿ï¼Œå¯ä»¥åœ¨ç›¸åº”ä½ç½®æ‰“ä¸Šæ–­ç‚¹ï¼Œç„¶åç›´æ¥åœ¨æ§åˆ¶å°è¾“å…¥ï¼Œçœ‹è¿”å›å€¼æ˜¯ä»€ä¹ˆã€‚</p>
<pre><code class="language-js">o(459)
&gt; 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'
</code></pre>
<p>æŠŠå‡½æ•°è¿˜åŸåï¼Œé—®äº†ä¸‹ Chatgpt è¿™æ˜¯ä»€ä¹ˆç®—æ³•ï¼Œå› ä¸º 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx' æ ¼å¼çœ‹èµ·æ¥å¥½åƒå’Œ UUID æœ‰å…³ç³»ã€‚</p>
<figure data-type="image" tabindex="3"><img src="https://blog.diyworld.me/post-images/1691691240524.jpg" alt="" loading="lazy"></figure>
<p>æœç„¶ï¼Œè¿™æ®µä»£ç çš„ä½œç”¨æ˜¯ç”Ÿæˆä¸€ä¸ªéšæœºçš„ UUID å€¼ï¼Œæ—¢ç„¶æ˜¯éšæœºçš„é‚£å°±å¥½è¯´äº†ã€‚</p>
<h3 id="x-sign"><code>x-sign</code></h3>
<p>sign çš„å€¼æ˜¯40ä½å­—ç¬¦ä¸²ï¼Œç›²çŒœæ˜¯å°†æ—¶é—´æˆ³ï¼ŒUUID ä»€ä¹ˆçš„è¿›è¡ŒSHA-1ç®—å‡ºæ¥çš„ç»“æœã€‚</p>
<figure data-type="image" tabindex="4"><img src="https://blog.diyworld.me/post-images/1691691604023.jpg" alt="" loading="lazy"></figure>
<p>å®šä½åˆ°ç›¸å…³ä»£ç ï¼Œå¹¶è¿˜åŸå‚æ•°ã€‚</p>
<pre><code class="language-js">for (m = function (t) {
        var e = A;
        return l.allocate(l.intArrayFromString(t), l.ALLOC_NORMAL)
    },
    E = l._getSign(I, m(t.skey), m(t.body), m(n), m(f.toString()), y, e.length),
    b = new Uint8Array(l.asm.memory.buffer), B = [], w = E; 0 !== b[w];) B.push(b[w]), w += 1;
return Q = (new TextDecoder).decode(new Uint8Array(B))
</code></pre>
<p>m å‡½æ•°æ˜¯å°†ä¼ å…¥çš„ t å­—ç¬¦ä¸²è½¬æ¢ä¸ºASCIIç¼–ç çš„æ•°ç»„ï¼Œå¹¶ä¸ºå…¶åˆ†é…å†…å­˜ï¼Œç„¶åè¿”å›å…¶æ‰€åœ¨çš„å†…å­˜åœ°å€ï¼Œl.ALLOC_NORMALå§‹ç»ˆä¸º0ï¼Œè¿™ä¸ªå‡½æ•°å®¹æ˜“è‡ªå·±å®ç°ã€‚å»æŸ¥æ‰¾ allocate å‡½æ•°çš„å®ç°ï¼Œå‘ç°å‡½æ•°å†…éƒ¨åˆç‰µæ‰¯åˆ°å¾ˆå¤šå…¶ä»–å€¼ï¼Œå¹²è„†å°±è‡ªå·±å®ç°è¿™ä¸ªå‡½æ•°å§ã€‚</p>
<p>_getSign å‡½æ•°ä¾æ¬¡æ¥æ”¶ä»¥ä¸‹å€¼çš„å†…å­˜åœ°å€ï¼Œå¹¶è¿”å›å›ºå®šå€¼èµ‹å€¼ç»™ Eã€‚</p>
<ul>
<li>I: ä¸çŸ¥é“æ˜¯å“ªé‡Œæ¥çš„å€¼ï¼Œç”Ÿæˆè¿‡ç¨‹å¾ˆå¤æ‚ï¼Œä¸è¿‡å¥½åœ¨ä¸€ç›´æ˜¯ä¸ªå›ºå®šå€¼ã€‚</li>
<li>t.skey: æ˜¯ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ã€‚</li>
<li>t.body: è¯·æ±‚æ­£æ–‡ã€‚</li>
<li>nonce: ä¹Ÿå°±æ˜¯å‰é¢ç”Ÿæˆçš„éšæœºUUIDã€‚</li>
<li>f.toString(): å…¶å®å°±æ˜¯æ—¶é—´æˆ³è½¬å­—ç¬¦ä¸²ã€‚</li>
<li>y: ä¸çŸ¥é“æ˜¯å“ªé‡Œæ¥çš„å€¼ï¼Œä¹Ÿæ˜¯å›ºå®šå€¼ã€‚</li>
</ul>
<p>b æ˜¯å°†å†…å­˜å€¼è½¬ä¸ºUint8Arrayçš„æ•°ç»„ï¼Œç„¶åä»Eä½ç½®å‘åéå†ï¼Œå¦‚æœä¸ç­‰äº0å°±å­˜å…¥Bæ•°ç»„ï¼Œæ­£å¥½èƒ½å­˜å¤Ÿ40ä¸ªå€¼ï¼Œå†å°†Bæ•°ç»„çš„ASCIIç è½¬å›å­—ç¬¦ä¸²ï¼Œæœ€å return çš„ Q å°±æ˜¯ sign çš„å€¼ã€‚</p>
<p>å…³é”®å°±åœ¨ _getSign å‡½æ•°äº†ï¼ŒçŒœæµ‹æ˜¯è¿™ä¸ªå‡½æ•°é€šè¿‡ä¼ å…¥çš„å‡ ä¸ªå†…å­˜åœ°å€å€¼ï¼Œè¯»å–ç›¸åº”å†…å­˜çš„æ•°æ®ï¼Œè¿›è¡ŒæŸäº›è®¡ç®—åï¼Œå°†å€¼å†™åˆ°äº†ç›¸åº”çš„ E ä½ç½®ï¼Œç„¶åç»™Bæ•°ç»„éå†çš„ã€‚</p>
<h2 id="webassembly-åˆ†æ">WebAssembly åˆ†æ</h2>
<pre><code class="language-js">function et(t) {
    return function () {
        var e = A.asm;
        return L(J, &quot;native function `&quot; + t + &quot;` called before runtime initialization&quot;),
            e[t] || L(e[t], &quot;exported native function `&quot; + t + &quot;` not found&quot;),
            e[t].apply(null, arguments)
    }
}
</code></pre>
<p>è½¬åˆ°å‡½æ•°çš„å®šä¹‰ï¼Œå‘ç°æ˜¯è¿™æ ·çš„ï¼Œæ²¡è§è¿‡ï¼Œé—®äº†é—® Chatgpt åˆæœäº†æœï¼Œæ‰çŸ¥é“è¿™æ˜¯ä¸€ä¸ªå« WebAssembly çš„ä¸œè¥¿ã€‚</p>
<blockquote>
<p>WebAssemblyæˆ–ç§°wasmæ˜¯ä¸€ä¸ªä½çº§ç¼–ç¨‹è¯­è¨€ã€‚WebAssemblyæ˜¯ä¾¿æºå¼çš„æŠ½è±¡è¯­æ³•æ ‘ï¼Œè¢«è®¾è®¡æ¥æä¾›æ¯”JavaScriptæ›´å¿«é€Ÿçš„ç¼–è¯‘åŠæ‰§è¡Œã€‚WebAssemblyå°†è®©å¼€å‘è€…èƒ½è¿ç”¨è‡ªå·±ç†Ÿæ‚‰çš„ç¼–ç¨‹è¯­è¨€ç¼–è¯‘ï¼Œå†è—‰è™šæ‹Ÿæœºå¼•æ“åœ¨æµè§ˆå™¨å†…æ‰§è¡Œã€‚</p>
</blockquote>
<p>ä¸Šè¾¹è¿™ä¸ªetå‡½æ•°çš„ä½œç”¨æ˜¯å¯¼å‡º wasm æ–‡ä»¶ä¸­çš„ getSign å‡½æ•°ï¼Œæ‰€ä»¥è·å–signå€¼çš„é€»è¾‘å°±å…¨åœ¨ wasm é‡Œäº†ã€‚</p>
<figure data-type="image" tabindex="5"><img src="https://blog.diyworld.me/post-images/1691693905964.jpg" alt="" loading="lazy"></figure>
<p>wasm æ–‡ä»¶å¯ä»¥åœ¨å·¦ä¾§æ é‡Œé¢æ‰¾åˆ°ï¼Œæ²¡æœ‰åœ¨ç½‘ç»œè¯·æ±‚é‡Œé¢å‘ç°ï¼Œä½†æ˜¯ js ä»£ç é‡Œé¢æœ‰ä¸€å¤§ä¸² Base64ï¼Œä¼°è®¡å°±æ˜¯ä»è¿™é‡Œè¯»å–è½¬æ¢æ¥çš„ã€‚</p>
<figure data-type="image" tabindex="6"><img src="https://blog.diyworld.me/post-images/1691694094831.jpg" alt="" loading="lazy"></figure>
<p>å®šä½åˆ° getSign å‡½æ•°ï¼Œå‚æ•°æ˜¯6ä¸ªå€¼ï¼Œé‚£å°±æ˜¯è¿™ä¸ªå‡½æ•°æ²¡é”™äº†ï¼Œwasm æ–‡ä»¶å†…å®¹ç±»ä¼¼äºæ±‡ç¼–è¯­è¨€ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯å¯¹å†…å­˜åœ°å€é‡Œé¢çš„å€¼è¿›è¡Œ subï¼Œaddï¼Œandï¼Œor å’Œ å…¥æ ˆå‡ºæ ˆ ç­‰æ“ä½œã€‚</p>
<p>æ¯”å¦‚ï¼š</p>
<pre><code>global.get $global0 //å–å…¨å±€å˜é‡ $global0 çš„å€¼
    local.set $var7 // èµ‹å€¼ä¸º $var7
    i32.const 256 // å®šä¹‰å€¼ 256
    local.set $var8 // æŠŠ256èµ‹å€¼ç»™ $var8 
    local.get $var7 //å–å˜é‡ $var7
    local.get $var8 //å–å˜é‡ $var8
    i32.sub //$var7 - $var8
    local.set $var9 //æŠŠç»“æœè®¾èµ‹å€¼ä¸º $var9 
    --------------------------------------------------
    local.get $var9 //å–å˜é‡ $var9
    local.get $var6 //å–å˜é‡ $var6
    i32.store offset=228 //å°†å˜é‡ $var6 å†™å…¥åˆ° $var9+228 çš„åœ°å€
    local.get $var9  //å–å˜é‡ $var9
    i32.load offset=252 //åŠ è½½ $var9 + 252 åœ°å€çš„å€¼
    local.set $var10    //èµ‹å€¼ç»™ $var10

</code></pre>
<p>æ‰€ä»¥åªè¦ä¸€æ­¥ä¸€æ­¥çš„åœ¨å‡½æ•°å…¥å£è·Ÿä¸‹å»å°±èƒ½çŸ¥é“å‡½æ•°çš„é€»è¾‘ï¼Œä¹Ÿå°±çŸ¥é“è¿™ä¸ªå‡½æ•°åšäº†ä»€ä¹ˆæ“ä½œï¼Œæ¯•ç«Ÿæ˜¯æ±‡ç¼–è¯­è¨€ï¼Œè¯»èµ·æ¥æ²¡é‚£ä¹ˆéš¾ï¼Œå°±æ˜¯æœ‰ç‚¹ç¹çã€‚</p>
<p>ä½†æ˜¯......æˆ‘è·Ÿäº†å°†è¿‘3å¤©ï¼Œè¿40ä½ sign çš„ç¬¬ä¸€ä¸ªå€¼çš„é€»è¾‘éƒ½æ²¡æ‹æ¸…æ¥šï¼Œåœ¨è¿™ä¸ªå‡½æ•°é‡Œé¢å„ç§Aå¥—Bï¼ŒBå¥—Cï¼ŒCåˆå¥—Dçš„æ“ä½œï¼Œä¸€ç‚¹ä¸€ç‚¹ä¸‹æ–­ç‚¹è°ƒè¯•åŠå…¶è€—æ—¶é—´ã€‚</p>
<p>åƒæ˜¯ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œé¡ºè—¤æ‘¸ç“œé¡ºäº†é‚£ä¹ˆé•¿çš„è—¤ä¹Ÿæ²¡æ‘¸åˆ°ç“œã€‚æ²¡åŠæ³•ï¼Œå¤ªæµªè´¹æ—¶é—´ï¼Œåªèƒ½æ”¾å¼ƒè¿™ä¸ªåŠæ³•ã€‚</p>
<figure data-type="image" tabindex="7"><img src="https://blog.diyworld.me/post-images/1691727712747.jpg" alt="" loading="lazy"></figure>
<p>å¥½åœ¨è¿˜æœ‰ç¬¬äºŒç§æ–¹æ³•ï¼Œåœ¨ wasm çš„ç®—æ³•åˆ†æä¸å‡ºæ¥æ—¶å¯ä»¥ç”¨ nodejs è°ƒç”¨ wasm å¯¼å‡ºéœ€è¦çš„å‡½æ•°ï¼Œç›´æ¥æ‹¿æ¥ç”¨ã€‚</p>
<h3 id="å¯¼å…¥å‡½æ•°">å¯¼å…¥å‡½æ•°</h3>
<p>é¦–å…ˆå°†æµè§ˆå™¨å†…åŒ…å«getSignå‡½æ•°çš„æ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°ï¼Œç”¨ <a href="https://github.com/WebAssembly/wabt">wabt </a> å°† wat è½¬ä¸º wasmã€‚</p>
<pre><code class="language-bash">$ wat2wasm test.wat -o test.wasm
</code></pre>
<p>æ¥ç€æŠŠwasmæ–‡ä»¶è¯»å…¥ã€‚</p>
<pre><code class="language-js">const fs = require('fs');
const wasmFile = 'test.wasm';
var importObject = {
    env: {
       /* å¯¼å…¥å‡½æ•°*/
    }
};
var wasmObject = new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array(fs.readFileSync(wasmFile))), importObject);
var wasmMemory = wasmObject.exports.memory;
</code></pre>
<p>ç›´æ¥è¿è¡Œçš„è¯ä¼šæŠ¥é”™ï¼Œæç¤ºç¼ºå°‘ <code>__assert_fail</code> å¯¼å…¥å‡½æ•°ã€‚</p>
<figure data-type="image" tabindex="8"><img src="https://blog.diyworld.me/post-images/1691736559168.jpg" alt="" loading="lazy"></figure>
<blockquote>
<p>importObject å¯¹è±¡æ˜¯åœ¨ä½¿ç”¨ JavaScript å°† WebAssembly æ¨¡å—ä¸å¤–éƒ¨ç¯å¢ƒé›†æˆæ—¶çš„ä¸€ç§æœºåˆ¶ã€‚å®ƒç”¨äºå®šä¹‰å°†ä»å¤–éƒ¨ç¯å¢ƒå¯¼å…¥åˆ° WebAssembly æ¨¡å—ä¸­çš„å‡½æ•°ã€å…¨å±€å˜é‡ç­‰å®ä½“ã€‚é€šè¿‡ä½¿ç”¨ importObjectï¼Œå¯ä»¥åœ¨ WebAssembly æ¨¡å—ä¸­ä½¿ç”¨æ¥è‡ªå¤–éƒ¨ç¯å¢ƒçš„åŠŸèƒ½ï¼Œå®ç°æ¨¡å—ä¸å®¿ä¸»ç¯å¢ƒä¹‹é—´çš„äº¤äº’ã€‚</p>
</blockquote>
<p>å¯¼å…¥å‡½æ•°å°±è¦å»åŸ js æ–‡ä»¶ä¸­å¯»æ‰¾ï¼Œæœç´¢å­—ç¬¦ä¸² <code>__assert_fail</code>ï¼Œå‘ç°åªæœ‰ä¸€ä¸ªåŒ¹é…é¡¹</p>
<figure data-type="image" tabindex="9"><img src="https://blog.diyworld.me/post-images/1691736748828.jpg" alt="" loading="lazy"></figure>
<p>æŠŠæ•´ä¸ª dt å¤åˆ¶åˆ° env å»è¯•è¯•ï¼Œç›´æ¥è¿è¡Œå‘ç°æ²¡æœ‰æŠ¥é”™ï¼Œå¯ä»¥æ­£å¸¸è¯»åˆ°å†…å­˜ã€‚</p>
<pre><code class="language-js">console.log(wasmMemory)
&gt; Memory [WebAssembly.Memory] {}
</code></pre>
<h3 id="å¯¼å‡ºå‡½æ•°">å¯¼å‡ºå‡½æ•°</h3>
<p>ä¹‹åå¯ä»¥è¯•ç€è°ƒç”¨ getSign å‡½æ•°äº†ï¼Œéšä¾¿è¾“å…¥ç‚¹å†…å­˜åœ°å€ï¼Œå¯ä»¥æ­£å¸¸è¾“å‡º40ä½å­—ç¬¦ä¸²ã€‚</p>
<pre><code class="language-js">console.log(wasmObject.exports.getSign(66264, 66264, 66264, 66264, 66264, 66368, 5));
&gt; 05685ab5d3b988de577bdee6689fbbc43fa9be62
</code></pre>
<p>æ¥ä¸‹æ¥å°±æ˜¯è¦æƒ³åŠæ³•å®ç°å‰é¢çš„ m å‡½æ•°ï¼Œå³ä¼ å…¥å­—ç¬¦ä¸²ç”Ÿæˆå¯¹åº”ASCIIæ•°ç»„å¹¶è¿”å›æ•°ç»„æ‰€åœ¨ä½ç½®ã€‚</p>
<pre><code class="language-js">memoryArray = new Uint8Array(wasmMemory.buffer) //å°†å†…å­˜æ•°æ®è½¬æ¢ä¸ºæ•°ç»„
writeMark = 70000; // å†™å…¥èµ·å§‹ä½ç½®

//å°†å­—ç¬¦ä¸²å†™å…¥å†…å­˜
function writeStringToMemory(string) {
    function lengthBytesUTF8(str) {
        var len = 0;
        for (var i = 0; i &lt; str.length; ++i) {
            var u = str.charCodeAt(i); 
            if (u &gt;= 0xD800 &amp;&amp; u &lt;= 0xDFFF) u = 0x10000 + ((u &amp; 0x3FF) &lt;&lt; 10) | (str.charCodeAt(++i) &amp; 0x3FF);
            if (u &lt;= 0x7F) {
                ++len;
            } else if (u &lt;= 0x7FF) {
                len += 2;
            } else if (u &lt;= 0xFFFF) {
                len += 3;
            } else if (u &lt;= 0x1FFFFF) {
                len += 4;
            } else if (u &lt;= 0x3FFFFFF) {
                len += 5;
            } else {
                len += 6;
            }
        }
        return len;
    }

    function stringToUTF8Array(str, outU8Array, outIdx, maxBytesToWrite) {
        if (!(maxBytesToWrite &gt; 0))
            return 0;

        var startIdx = outIdx;
        var endIdx = outIdx + maxBytesToWrite - 1;
        for (var i = 0; i &lt; str.length; ++i) {
            var u = str.charCodeAt(i);
            if (u &gt;= 0xD800 &amp;&amp; u &lt;= 0xDFFF) u = 0x10000 + ((u &amp; 0x3FF) &lt;&lt; 10) | (str.charCodeAt(++i) &amp; 0x3FF);
            if (u &lt;= 0x7F) {
                if (outIdx &gt;= endIdx) break;
                outU8Array[outIdx++] = u;
            } else if (u &lt;= 0x7FF) {
                if (outIdx + 1 &gt;= endIdx) break;
                outU8Array[outIdx++] = 0xC0 | (u &gt;&gt; 6);
                outU8Array[outIdx++] = 0x80 | (u &amp; 63);
            } else if (u &lt;= 0xFFFF) {
                if (outIdx + 2 &gt;= endIdx) break;
                outU8Array[outIdx++] = 0xE0 | (u &gt;&gt; 12);
                outU8Array[outIdx++] = 0x80 | ((u &gt;&gt; 6) &amp; 63);
                outU8Array[outIdx++] = 0x80 | (u &amp; 63);
            } else if (u &lt;= 0x1FFFFF) {
                if (outIdx + 3 &gt;= endIdx) break;
                outU8Array[outIdx++] = 0xF0 | (u &gt;&gt; 18);
                outU8Array[outIdx++] = 0x80 | ((u &gt;&gt; 12) &amp; 63);
                outU8Array[outIdx++] = 0x80 | ((u &gt;&gt; 6) &amp; 63);
                outU8Array[outIdx++] = 0x80 | (u &amp; 63);
            } else if (u &lt;= 0x3FFFFFF) {
                if (outIdx + 4 &gt;= endIdx) break;
                outU8Array[outIdx++] = 0xF8 | (u &gt;&gt; 24);
                outU8Array[outIdx++] = 0x80 | ((u &gt;&gt; 18) &amp; 63);
                outU8Array[outIdx++] = 0x80 | ((u &gt;&gt; 12) &amp; 63);
                outU8Array[outIdx++] = 0x80 | ((u &gt;&gt; 6) &amp; 63);
                outU8Array[outIdx++] = 0x80 | (u &amp; 63);
            } else {
                if (outIdx + 5 &gt;= endIdx) break;
                outU8Array[outIdx++] = 0xFC | (u &gt;&gt; 30);
                outU8Array[outIdx++] = 0x80 | ((u &gt;&gt; 24) &amp; 63);
                outU8Array[outIdx++] = 0x80 | ((u &gt;&gt; 18) &amp; 63);
                outU8Array[outIdx++] = 0x80 | ((u &gt;&gt; 12) &amp; 63);
                outU8Array[outIdx++] = 0x80 | ((u &gt;&gt; 6) &amp; 63);
                outU8Array[outIdx++] = 0x80 | (u &amp; 63);
            }
        }
        outU8Array[outIdx] = 0;
        return outIdx - startIdx;
    }

    function intArrayFromString(stringy, dontAddNull, length) {
        var len = length &gt; 0 ? length : lengthBytesUTF8(stringy) + 1;
        var u8array = new Array(len);
        var numBytesWritten = stringToUTF8Array(stringy, u8array, 0, u8array.length);
        if (dontAddNull) u8array.length = numBytesWritten;
        return u8array;
    }

    var intArray = intArrayFromString(string, 0);
    for (var i = 0; i &lt; intArray.length; i++) {
        memoryArray[writeMark + i] = intArray[i];
    }
    var address = writeMark;
    writeMark += intArray.length;
    return address;
}
</code></pre>
<p>é€šè¿‡å¤šæ¬¡å°è¯•ï¼Œå‘ç°åœ¨å†…å­˜åœ°å€ 70000 ä¹‹åå†™æ•°æ®æ˜¯ä¸ä¼šä¸å…¶ä»–å€¼å†²çªå½±å“signçš„è¾“å‡ºçš„ï¼Œæ‰€ä»¥writeMarkæ˜¯ä»70000å¼€å§‹çš„ã€‚</p>
<p>må‡½æ•°å®ç°äº†ï¼ŒgetSignå‡½æ•°çš„ç¬¬2åˆ°5ä¸ªå‚æ•°çš„æ¥æºä¹Ÿå°±æå®šäº†ã€‚æ¥ä¸‹æ¥å°±æ˜¯ç ”ç©¶ getSign çš„1ï¼Œ6ï¼Œ7 è¿™ä¸‰ä¸ªå‚æ•°çš„æ„ä¹‰äº†ï¼Œ1ï¼Œ6æ˜æ˜¾æ˜¯å’Œmå‡½æ•°è¿”å›å€¼ä¸€æ ·æ ‡æ³¨ç€æ•°æ®çš„æ‰€åœ¨ä½ç½®ï¼Œç¬¬7ä¸ªå‚æ•°ï¼Œé€šè¿‡åˆ†æ js ä»£ç ï¼Œè²Œä¼¼æ˜¯ä¸€ä¸ªæ•°ç»„çš„é•¿åº¦ï¼Œæ˜¯ä¸€ä¸ªå›ºå®šæ•°å€¼ã€‚</p>
<p>å› ä¸º js ä»£ç å¯è¯»æ€§å¤ªå·®äº†ï¼Œæˆ‘ä¹Ÿæ‡’çš„å†å»æ‰¾å“ªä¸€æ®µçš„jsä»£ç åœ¨å“ªé‡Œå¾€å†…å­˜å†™å…¥äº†æ•°æ®ï¼Œå¹¶å¾—åˆ°äº†åœ°å€ä»¥ä¼ ç»™getSignå‡½æ•°ã€‚æ‰€ä»¥ï¼Œæˆ‘åå¤è§‚å¯Ÿåœ¨å“ªä¸€æ®µåœ°å€çš„å†…å­˜å†™å…¥è„æ•°æ®ä¼šå½±å“signå€¼çš„è¾“å‡ºï¼Œæœ€ç»ˆå°†èŒƒå›´ç¼©å°åˆ°äº† 65500 - 66500 ï¼Œçœ‹æ¥è¿™ä¸€æ®µå†…å­˜é‡Œé¢æœ‰å½±å“åˆ°signç”Ÿæˆçš„å‚æ•°ï¼Œä¹ŸåŒ…æ‹¬äº†æˆ‘ä¸çŸ¥é“çš„å‚æ•°1å’Œå‚æ•°6ã€‚</p>
<p>é‚£ä¹ˆï¼Œåœ¨ç½‘é¡µè°ƒç”¨getSignå‡½æ•°ä¹‹å‰ï¼ŒæŠŠ 65500 - 66500 è¿™ä¸€æ®µå†…å­˜çš„å€¼å…¨éƒ¨å–å‡ºæ¥ï¼Œåœ¨è°ƒç”¨æˆ‘è‡ªå·±å®ç°çš„getSignå‡½æ•°å‰å†å°†å…¶å†™å…¥åˆ°å†…å­˜é‡Œé¢ä¸å°±è¡Œäº†ï¼Ÿæœ€åå®ç°çš„ getSign å‡½æ•°å¦‚ä¸‹</p>
<pre><code class="language-js">function getSign(skey, body, nonce, timestamp) {
    Init();
    var begin = wasmObject.exports.getSign(66264, writeStringToMemory(skey), writeStringToMemory(body), writeStringToMemory(nonce), writeStringToMemory(timestamp), 66368, 5);
    for (signArray = []; 0 !== memoryArray[begin];)
        signArray.push(memoryArray[begin]), begin += 1;
    sign = (new TextDecoder).decode(new Uint8Array(signArray));
    return sign;
}
</code></pre>
<p>ç»è¿‡æµ‹è¯•ï¼Œä¸ç½‘é¡µä¸Šç”Ÿæˆçš„ç»“æœä¸€è‡´ã€‚<br>
<img src="https://blog.diyworld.me/post-images/1691740786716.jpg" alt="" loading="lazy"></p>
<p>åƒè¿™ç§åˆ†æç®—æ³•è¿‡ç¨‹å¤ªå¤æ‚çš„è¿˜ä¸å¦‚ç›´æ¥æ‹¿æ¥ç”¨ï¼Œç›´æ¥æ‹¿æ¥ç”¨æ‰èŠ±äº†æˆ‘ä¸€ä¸‹åˆæ—¶é—´ã€‚è€Œä¸”è¿™ä¸ª wasm å¯¹ bom å’Œ dom éƒ½æ²¡æœ‰æ£€æµ‹ï¼Œæ–¹ä¾¿çš„å¾ˆã€‚</p>
<hr>
<p>wasmç›¸å…³æ•™ç¨‹ï¼š<br>
<a href="https://www.bilibili.com/video/BV1tM411K7Xx">Nodejsè°ƒç”¨æ‰£å–wasm</a><br>
<a href="https://www.52pojie.cn/thread-1487959-1-1.html">æŸç½‘ç«™å¿ƒè·³åŒ…å‚æ•°åŠ å¯†çš„wasmåˆ†æ</a></p>

          </div>
        </div>

        
          <div class="next-post">
            <a class="purple-link" href="https://blog.diyworld.me/post/VQwzboRI2/">
              <h3 class="post-title">
                ä¸‹ä¸€ç¯‡ï¼šDocker ç¬”è®°
              </h3>
            </a>
          </div>
          
      </div>

      
        
          <div id="gitalk-container"></div>
        

        
      

      <div class="site-footer">
  <div class="slogan">ç”Ÿå‘½ä¸æ¯ï¼ŒæŠ˜è…¾ä¸æ­¢</div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <a class="rss" href="https://blog.diyworld.me/atom.xml" target="_blank">RSS</a>
</div>


    </div>
    <script type="application/javascript">

hljs.initHighlightingOnLoad()

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>



  
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>

      var gitalk = new Gitalk({
        clientID: 'df0154d6a9f45f1e95f3',
        clientSecret: '72bdef4a1fb6001d84fb3f09c9e7c840c4887d68',
        repo: 'RoromoriYuzu.github.io',
        owner: 'RoromoriYuzu',
        admin: ['RoromoriYuzu'],
        id: (location.pathname).substring(0, 49),      // Ensure uniqueness and length less than 50
        distractionFreeMode: false  // Facebook-like distraction free mode
      })

      gitalk.render('gitalk-container')

    </script>
  

  




  </body>
</html>
