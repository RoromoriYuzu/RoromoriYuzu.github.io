
<!DOCTYPE html>
<html>
  <head>
    
<meta charset="utf-8" >

<title>ä¹¦æ¥ä¸Šå› å°ç¨‹åºè§£åŒ…é€†å‘åˆ†æ Sign ç”Ÿæˆé€»è¾‘ | è·¯è·¯æ£®</title>
<meta name="description" content="ç”Ÿå‘½ä¸æ¯ï¼ŒæŠ˜è…¾ä¸æ­¢">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://blog.diyworld.me/favicon.ico?v=1747968425405">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://blog.diyworld.me/styles/main.css">


  
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css" />
  

  


<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.1/build/highlight.min.js"></script>



  </head>
  <body>
    <div id="app" class="main">
      <div class="site-header-container">
  <div class="site-header">
    <div class="left">
      <a href="https://blog.diyworld.me">
        <img class="avatar" src="https://blog.diyworld.me/images/avatar.png?v=1747968425405" alt="" width="32px" height="32px">
      </a>
      <a href="https://blog.diyworld.me">
        <h1 class="site-title">è·¯è·¯æ£®</h1>
      </a>
    </div>
    <div class="right">
      <transition name="fade">
        <i class="icon" :class="{ 'icon-close-outline': menuVisible, 'icon-menu-outline': !menuVisible }" @click="menuVisible = !menuVisible"></i>
      </transition>
    </div>
  </div>
</div>

<transition name="fade">
  <div class="menu-container" style="display: none;" v-show="menuVisible">
    <div class="menu-list">
      
        
          <a href="/" class="menu purple-link">
            é¦–é¡µ
          </a>
        
      
        
          <a href="/archives" class="menu purple-link">
            å½’æ¡£
          </a>
        
      
        
          <a href="/tags" class="menu purple-link">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="https://RoromoriYuzu.github.io/post/note" class="menu purple-link">
            è®°å½•
          </a>
        
      
        
          <a href="/post/about" class="menu purple-link">
            å…³äº
          </a>
        
      
    </div>
  </div>
</transition>


      <div class="content-container">
        <div class="post-detail">
          
          <h2 class="post-title">ä¹¦æ¥ä¸Šå› å°ç¨‹åºè§£åŒ…é€†å‘åˆ†æ Sign ç”Ÿæˆé€»è¾‘</h2>
          <div class="post-info post-detail-info">
            <span><i class="icon-calendar-outline"></i> 2023-08-14</span>
            
              <span>
                <i class="icon-pricetags-outline"></i>
                
                  <a href="https://blog.diyworld.me/tag/OE_gcQIAN/">
                    é€†å‘
                    
                      ï¼Œ
                    
                  </a>
                
                  <a href="https://blog.diyworld.me/tag/A9NeaOFri5/">
                    å­¦ä¹ 
                    
                      ï¼Œ
                    
                  </a>
                
                  <a href="https://blog.diyworld.me/tag/uTKWNErwT/">
                    Javascript
                    
                  </a>
                
              </span>
            
          </div>
          <div class="post-content" v-pre>
            <p><ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E9%80%86%E5%90%91%E5%B0%8F%E7%A8%8B%E5%BA%8F">é€†å‘å°ç¨‹åº</a></li>
<li><a href="#%E5%88%86%E6%9E%90%E4%BB%A3%E7%A0%81">åˆ†æä»£ç </a>
<ul>
<li><a href="#%E7%94%9F%E6%88%90%E9%80%BB%E8%BE%91">ç”Ÿæˆé€»è¾‘</a></li>
</ul>
</li>
<li><a href="#%E7%BB%93%E8%AF%AD">ç»“è¯­</a></li>
</ul>
</li>
</ul>
</p>
<blockquote>
<p>ä¸Šä¸€ç« è¯´åˆ°é€šè¿‡ç›´æ¥è°ƒç”¨ wasm æ¥å®ç°ç”Ÿæˆ Signï¼Œä½†å‘ç°åªé’ˆå¯¹é‚£ä¸€ä¸ªåŸŸåæ¥å£çš„è¯·æ±‚æœ‰æ•ˆï¼Œæ¢ä¸ªæ¥å£å°±ä¸è¡Œäº†ï¼Œçœ‹æ¥è¿˜æ˜¯è¦å½»åº•åˆ†æä»–çš„ç”Ÿæˆé€»è¾‘ã€‚</p>
</blockquote>
<h2 id="é€†å‘å°ç¨‹åº">é€†å‘å°ç¨‹åº</h2>
<p>åœ¨å°ç¨‹åºæ‰“å¼€å‰å°±å¯¹å®ƒæŠ“åŒ…ï¼Œç›´åˆ°é¡µé¢åŠ è½½å®Œæ¯•ä¹Ÿæ²¡å‘ç°ç›¸å…³jsçš„è¯·æ±‚ï¼Œè€Œä¸”apiçš„ referer:  éƒ½æ˜¯æŒ‡å‘äº† https://servicewechat.comï¼Œæ‰€ä»¥å¯ä»¥åŸºæœ¬ç¡®å®šç›¸å…³çš„jsæ–‡ä»¶éƒ½æ—©æ‰“åŒ…è¿›å°ç¨‹åºä¸‹è½½åˆ°äº†æœ¬åœ°ã€‚</p>
<p>æ‰“å¼€ç›®å½• <code>Documents\WeChat Files\Applet</code>  æ ¹æ®ä¿®æ”¹æ—¥æœŸå¯ä»¥ç¡®å®šå“ªä¸ªæ–‡ä»¶å¤¹å¯¹åº”ç€å°ç¨‹åºåŒ…ã€‚</p>
<figure data-type="image" tabindex="1"><img src="https://blog.diyworld.me/post-images/1692004689876.jpg" alt="" loading="lazy"></figure>
<p>æ¥ä¸‹æ¥éœ€è¦å¯¹ wxapkg æ–‡ä»¶è¿›è¡Œè§£å¯†ç„¶åè§£åŒ…ï¼Œç”±äºå¾®ä¿¡çš„æ›´æ–°ï¼Œåœ¨5æœˆä¹‹å‰çš„è§£åŒ…å·¥å…·éƒ½ä¸èƒ½æ­£å¸¸çš„è§£å¸¦æœ‰åˆ†åŒ…çš„å°ç¨‹åºï¼Œæˆ‘ç”¨çš„æ˜¯ unveilr.exe è½¬æ”¶è´¹å‰çš„ç‰ˆæœ¬ï¼Œèƒ½æ­£å¸¸çš„è§£å¤§éƒ¨åˆ†çš„æ–‡ä»¶ï¼Œä½†è¿˜æ˜¯æœ‰ç‚¹å°æ¯›ç—…ï¼Œç›¸å…³çš„è§£åŒ…æ•™ç¨‹å¯ä»¥å»ç½‘ä¸Šæ‰¾ã€‚</p>
<figure data-type="image" tabindex="2"><img src="https://blog.diyworld.me/post-images/1692004955216.jpg" alt="" loading="lazy"></figure>
<p>è§£åŒ…å®Œæˆåå¯ä»¥é€šè¿‡æ–‡ä»¶çš„å¤§å°ï¼Œæˆ–è€…æ˜¯å¦å­˜åœ¨ <code>app.json</code> æ–‡ä»¶æ¥ç¡®å®šæ˜¯å¦æˆåŠŸè§£åŒ…ï¼Œå°†è§£åŒ…åçš„ç›¸åº”æ–‡ä»¶å¤¹å¯¼å…¥å¾®ä¿¡å¼€å‘è€…å·¥å…·ï¼Œå¼€å§‹åŠ¨æ€è°ƒè¯•ã€‚</p>
<p>å› ä¸ºè§£åŒ…å·¥å…·æ¯”è¾ƒæ—§ï¼Œå¯¼å…¥åä¼šå‡ºç°ä¸å°‘æŠ¥é”™ï¼Œåªè¦æ ¹æ® <a href="https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html">å¾®ä¿¡å®˜æ–¹æ–‡æ¡£</a> ç¨å¾®æ”¹æ”¹å°±å¯ä»¥æ­£å¸¸ç¼–è¯‘ï¼Œä¸éœ€è¦çš„é¡µé¢å¯ä»¥å»æ‰ï¼Œåªä¿ç•™éœ€è¦åˆ†æçš„åœ°æ–¹ã€‚</p>
<p><code>app.json</code> æ–‡ä»¶ä¸­çš„ <code>plugins</code>å¯¹è±¡å†…å®¹å¯ä»¥åˆ é™¤ï¼Œå¦åˆ™ä¼šæŠ¥é”™æœªæˆæƒä½¿ç”¨æ’ä»¶ã€‚å…¶ä»–è¯·æ±‚ç™»å½•æ¥å£æŠ¥é”™çš„å¯ä»¥æŠ“åŒ…æ‹¦æˆªä¸‹æ¥ï¼Œä¿®æ”¹ä¸ºåŸæœ¬å°ç¨‹åºçš„è¿”å›åŒ…ã€‚</p>
<p>å¦‚æœæƒ³è¦ç¬¬ä¸€å±è®¾ç½®ä¸ºåˆ†åŒ…é¡µé¢ï¼Œé‚£å°±å°† <code>pages</code> å¯¹è±¡æ·»åŠ å¯¹åº”åˆ†åŒ…é¡µé¢ï¼Œå¹¶åˆ é™¤ <code>preloadRule</code> å¯¹è±¡ä¸­çš„åˆ†åŒ…é¡µé¢ç›¸å…³ä¿¡æ¯ï¼Œå¦åˆ™ä¼šæŠ¥é”™ <code>pages *** ä¸åº”è¯¥åœ¨åˆ†åŒ… subPackages[*] ä¸­</code>ï¼Œä¹‹åé‡æ–°ç¼–è¯‘å³å¯è¿›å…¥è®¾ç½®çš„é¡µé¢ã€‚</p>
<h2 id="åˆ†æä»£ç ">åˆ†æä»£ç </h2>
<p>å…¨å±€æœç´¢å…³é”®å­— Sign å¯ä»¥æ‰¾åˆ°ç›¸å…³ä»£ç æ®µï¼Œè€Œä¸”ä»£ç æ²¡æœ‰åšæ··æ·†å¤„ç†ï¼Œåˆ†æèµ·æ¥éå¸¸å®¹æ˜“ã€‚</p>
<p>æ¯”å¦‚è¿™ä¸€æ®µï¼Œä¸€çœ¼å°±å¯ä»¥çœ‹å‡ºæ˜¯ sha1 å¤„ç†å‡½æ•°ï¼Œä¼ å…¥å­—ç¬¦ä¸²ï¼Œè¿”å›sha1å­—ç¬¦ä¸²</p>
<pre><code class="language-js">function (e, t) {
        var n = global.bc(&quot;platform&quot;, &quot;cloud-fe-yunsdk-platform&quot;);
        e.exports = function (e) {
            var t, n, r = new Uint8Array(function (e) {
                var t, n, r, o = [];
                for (t = 0; t &lt; e.length; t++)(n = e.charCodeAt(t)) &lt; 128 ? o.push(n) : n &lt; 2048 ?
                    o.push(192 + (n &gt;&gt; 6 &amp; 31), 128 + (63 &amp; n)) : ((r = 55296 ^ n) &gt;&gt; 10 == 0 ? (n =
                        (r &lt;&lt; 10) + (56320 ^ e.charCodeAt(++t)) + 65536, o.push(240 + (n &gt;&gt; 18 &amp;
                            7), 128 + (n &gt;&gt; 12 &amp; 63))) : o.push(224 + (n &gt;&gt; 12 &amp; 15)), o.push(
                                128 + (n &gt;&gt; 6 &amp; 63), 128 + (63 &amp; n)));
                return o
            }(e)),
                o = 16 + (r.length + 8 &gt;&gt;&gt; 6 &lt;&lt; 4);
            for ((e = new Uint8Array(o &lt;&lt; 2)).set(new Uint8Array(r.buffer)), e = new Uint32Array(e.buffer),
                n = new DataView(e.buffer), d = 0; d &lt; o; d++) e[d] = n.getUint32(d &lt;&lt; 2);
            e[r.length &gt;&gt; 2] |= 128 &lt;&lt; 24 - 8 * (3 &amp; r.length), e[o - 1] = r.length &lt;&lt; 3;
            var a = [],
                s = [function () {
                    return u[1] &amp; u[2] | ~u[1] &amp; u[3]
                }, function () {
                    return u[1] ^ u[2] ^ u[3]
                }, function () {
                    return u[1] &amp; u[2] | u[1] &amp; u[3] | u[2] &amp; u[3]
                }, function () {
                    return u[1] ^ u[2] ^ u[3]
                }],
                c = function (e, t) {
                    return e &lt;&lt; t | e &gt;&gt;&gt; 32 - t
                },
                i = [1518500249, 1859775393, -1894007588, -899497514],
                u = [1732584193, -271733879, null, null, -1009589776];
            for (u[2] = ~u[0], u[3] = ~u[1], d = 0; d &lt; e.length; d += 16) {
                var l = u.slice(0);
                for (t = 0; t &lt; 80; t++) a[t] = t &lt; 16 ? e[d + t] : c(a[t - 3] ^ a[t - 8] ^ a[t - 14] ^ a[t -
                    16], 1), n = c(u[0], 5) + s[t / 20 | 0]() + u[4] + a[t] + i[t / 20 | 0] | 0, u[1] =
                    c(u[1], 30), u.pop(), u.unshift(n);
                for (t = 0; t &lt; 5; t++) u[t] = u[t] + l[t] | 0
            }
            n = new DataView(new Uint32Array(u).buffer);
            for (var d = 0; d &lt; 5; d++) u[d] = n.getUint32(d &lt;&lt; 2);
            return Array.prototype.map.call(new Uint8Array(new Uint32Array(u).buffer), (function (e) {
                return (e &lt; 16 ? &quot;0&quot; : &quot;&quot;) + e.toString(16)
            })).join(&quot;&quot;)
        }
    }
</code></pre>
<p>è°ƒç”¨ sha1 ä¼ å…¥å­—ç¬¦ä¸²çš„å‡½æ•°æ˜¯</p>
<pre><code class="language-js">        function l(t, n) {
            var r = arguments.length &gt; 2 &amp;&amp; void 0 !== arguments[2] &amp;&amp; arguments[2];
            return function (n) {
                if (t.nonce = t.nonce || a()(), t.ts = t.ts || s.default.get(!1, !0), &quot;object&quot; == e(t.body))
                    try {
                        t.body = JSON.stringify(t.body)
                    } catch (n) {
                        t.body = &quot;&quot;
                    }
                n = n.map((function (e) {
                    return t[e]
                })).join(&quot;;&quot;);
                var o = i()(n);
                return r &amp;&amp; console.log(&quot;[SAFE]:&quot;, o, n), {
                    nonce: t.nonce,
                    ts: t.ts,
                    sign: o
                }
            }(n)
        }

</code></pre>
<p>æœ‰äº†ä¸Šé¢çš„è¿™äº›ï¼Œä¹Ÿå°±ä¸éš¾åˆ†æå‡ºç”Ÿæˆ signçš„é€»è¾‘äº†ã€‚</p>
<h3 id="ç”Ÿæˆé€»è¾‘">ç”Ÿæˆé€»è¾‘</h3>
<p>ä¼ å…¥çš„å‚æ•°tåŒ…å«æœ‰nonceï¼Œtså’Œbodyå±æ€§ï¼Œné€šè¿‡è§‚å¯Ÿå‰é¢çš„ä»£ç å¯ä»¥çŸ¥é“æ˜¯ <code>[&quot;signKey&quot;, &quot;skey&quot;, &quot;body&quot;, &quot;nonce&quot;, &quot;ts&quot;]</code>è¿™æ ·ä¸€ä¸ªæ•°ç»„ã€‚</p>
<p>é¦–å…ˆï¼Œç¬¬ä¸€ä¸ª if ä¼šæ£€æŸ¥ä¼ å…¥çš„t.nonceï¼Œt.ts æ˜¯å¦å­˜åœ¨ï¼Œå¦‚ä¸å­˜åœ¨åˆ™è°ƒç”¨ç›¸åº”å‡½æ•°ç”Ÿæˆï¼Œæ¥ç€åˆ¤æ–­bodyçš„ç±»å‹ï¼Œå¦‚æœæ˜¯ object åˆ™å°†å…¶è½¬æ¢ä¸ºjsonï¼Œè½¬æ¢å¤±è´¥åˆ™ç½®ç©ºã€‚ç„¶åæŒ‰ç…§næ•°ç»„çš„é¡ºåºï¼Œå°†æ•°ç»„å†…å®¹å¯¹åº”å€¼é€šè¿‡ <code>;</code> ç¬¦å·è¿æ¥èµ·æ¥å½¢æˆè¿™æ ·çš„å­—ç¬¦ä¸² <code>signKey;skey;body;nonce;ts</code> signKey çš„å€¼åœ¨å‰é¢çš„ä»£ç ä¹Ÿæœ‰(æ¢ä¸ªåŸŸåå°±ä¸å¯¹çš„åŸå› )ï¼Œskey ä¸ºauto-tokenã€‚å†æŠŠç”Ÿæˆçš„å­—ç¬¦ä¸²ä¼ ç»™ i å³ sha1 å‡½æ•°ï¼Œå¾—å‡º sign å€¼ã€‚</p>
<h2 id="ç»“è¯­">ç»“è¯­</h2>
<p>å¯¹äºè¿™ç§æ²¡æœ‰æ··æ·†çš„ä»£ç ï¼Œç”šè‡³ä¸ç”¨åŠ¨æ€è°ƒè¯•éƒ½å¯ä»¥çœ‹å‡ºç”Ÿæˆçš„é€»è¾‘ï¼Œä¾¿èƒ½çœæ‰è®©å…¶åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­è¿è¡Œçš„æ—¶é—´ã€‚</p>
<p>ä½†æ˜¯åŠ¨æ€è°ƒè¯•çš„è¯å¯ä»¥çœ‹åˆ°ä¸­é—´å˜é‡ï¼Œå‡å°‘åˆ†æè¿‡ç¨‹çš„é”™è¯¯ã€‚å°±æ¯”å¦‚æˆ‘ï¼Œæƒ³å½“ç„¶çš„è®¤ä¸ºæœ€åçš„Lå‡½æ•°å¿…å®šä¼šä¼ å…¥bodyï¼Œå› ä¸ºpostè¯·æ±‚çš„bodyå°±åœ¨é‚£é‡Œæ‘†ç€ï¼Œä½†sha1å‡½æ•°çš„è¾“å‡ºç»“æœæ€»æ˜¯å’Œå®é™…å€¼å¯¹ä¸èµ·æ¥ã€‚ç›´åˆ°æˆ‘åœ¨å¼€å‘è€…å·¥å…·é‡Œä¸‹æ–­ç‚¹è°ƒè¯•äº†å¥½å‡ éä¹‹åæ‰å‘ç°ï¼Œæœ‰çš„è¯·æ±‚è™½ç„¶æœ‰bodyï¼Œä½†å¹¶ä¸ä¼šå°†bodyä¼ å…¥Lå‡½æ•°ï¼Œsha1çš„è¾“å‡ºä¹Ÿè‡ªç„¶æ²¡æœ‰bodyçš„äº‹æƒ…ï¼Œä¸çŸ¥åˆ°æ˜¯ä»–ä»£ç é€»è¾‘å°±æ˜¯è¿™æ ·ï¼Œè¿˜æ˜¯è¯´æ˜¯å¼€å‘è€…å†™çš„bug ğŸ˜“</p>

          </div>
        </div>

        
          <div class="next-post">
            <a class="purple-link" href="https://blog.diyworld.me/post/bZdODaSxn/">
              <h3 class="post-title">
                ä¸‹ä¸€ç¯‡ï¼šé€†å‘ WebPack æ‰“åŒ…ç½‘ç«™ä½¿ç”¨ wasm åŠ å¯† Sign å‚æ•°çš„é€»è¾‘
              </h3>
            </a>
          </div>
          
      </div>

      
        
          <div id="gitalk-container"></div>
        

        
      

      <div class="site-footer">
  <div class="slogan">ç”Ÿå‘½ä¸æ¯ï¼ŒæŠ˜è…¾ä¸æ­¢</div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <a class="rss" href="https://blog.diyworld.me/atom.xml" target="_blank">RSS</a>
</div>


    </div>
    <script type="application/javascript">

hljs.initHighlightingOnLoad()

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>



  
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>

      var gitalk = new Gitalk({
        clientID: 'df0154d6a9f45f1e95f3',
        clientSecret: '72bdef4a1fb6001d84fb3f09c9e7c840c4887d68',
        repo: 'RoromoriYuzu.github.io',
        owner: 'RoromoriYuzu',
        admin: ['RoromoriYuzu'],
        id: (location.pathname).substring(0, 49),      // Ensure uniqueness and length less than 50
        distractionFreeMode: false  // Facebook-like distraction free mode
      })

      gitalk.render('gitalk-container')

    </script>
  

  




  </body>
</html>
